{% extends "base.html" %}
{% load urlify %}
{% load crispy_forms_tags %}

{% block content %}
<div class="col-md-8 mx-auto py-5">
    <h1>Thread</h1>

    <!-- Parent Comment -->
<div class="comment">
    <blockquote class="blockquote">
        
        <small class='text-muted'><strong>@{{ parent_comment.user }}</strong> | {{ parent_comment.timestamp|timesince }} ago| {% if children_comments.count > 0 %}{{ children_comments.count }} <i class="fas fa-comment"></i> |{% endif %}{%  if request.user == parent_comment.user %}<a href='{{ parent_comment.get_delete_url }}'> <i class="fa-solid fa-x text-danger"></i></a>{% endif %}</small>
        <p>{{ parent_comment.content }}</p>
    </blockquote>
    <hr/>
</div>

<!-- Children Comments -->
<div class="child-comments">
    {% for child_comment in children_comments %}
        <div class="comment">
            <blockquote class="blockquote ms-4">
                <small class='text-muted'><strong>@{{ child_comment.user }}</strong> | {{ child_comment.timestamp|timesince }} ago| {%  if request.user == child_comment.user %}<a href='{{ child_comment.get_delete_url }}'><i class="fa-solid fa-x text-danger"></i></a>{% endif %}</small>
                <p>{{ child_comment.content }}</p>
            </blockquote>
            
            <!-- Replies to Child Comment -->
            <div class="child-replies">
                {% for reply_comment in child_comment.children.all %}
                    <div class="comment">
                        <blockquote class="blockquote ms-4">
                            <small class='text-muted'><strong>@{{ reply_comment.user }}</strong> | {{ reply_comment.timestamp|timesince }} ago</small>
                            <p>{{ reply_comment.content }}</p>
                        </blockquote>
                    </div>
                {% endfor %}
            </div>
            
        </div>
    {% endfor %}
</div>

<!-- Reply comment form -->
<div id="reply-form-wrapper">
    {% if request.user.is_authenticated %}
    <form id="parent-comment-reply-form" class="reply-comment-form" method="post">
        {% csrf_token %}
        <input type="hidden" name="content_type" value="{{ parent_comment.content_type }}">
        <input type="hidden" name="object_id" value="{{ parent_comment.object_id }}">
        {{ comment_form|crispy }}
        <input type="submit" value="Reply" class="btn btn-primary">
    </form>
    {% else %}
    <p>You must login to comment</p>
    {% endif %}
</div>



</div>
{% endblock content %}
